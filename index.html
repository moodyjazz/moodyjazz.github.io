<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>moody jazz minis</title>
  <style>
    body {
      margin: 0;
      padding: 0 20px;
      line-height: 1.6;
      font-family: sans-serif;
    }

    h1, h2 {
      margin: 10px 0;
      text-align: left;
      padding-left: 10px;
    }

    p {
      margin: 0 0 20px;
      text-align: left;
      padding-left: 10px;
    }

    iframe {
      width: 100%;
      height: 600px;
      max-height: 600px;
      border: none;
    }

    .pm-attribution-div {
      font-size: 12px;
      color: rgb(102, 102, 102);
      padding-top: 5px;
      margin-top: 10px;
      text-align: center;
    }

    ol {
      list-style-type: decimal;
      padding: 0 20px;
      margin: 0;
      text-align: left;
    }

    li {
      margin-bottom: 5px;
      text-align: left;
    }

    details {
      display: inline;
      margin-left: 10px;
    }

    details[open] p {
      display: block;
      margin-top: 5px;
    }

    @media (max-width: 600px) {
      h1 {
        font-size: 1.5em;
      }
      h2 {
        font-size: 1.2em;
      }
      .pm-attribution-div {
        font-size: 10px;
      }
      iframe {
        height: 500px;
      }
    }

    body::after {
      content: '';
      display: block;
      height: 100px;
    }
  </style>
</head>

<body>
  <h1>moody jazz minis</h1>
  <p>play the most recent crossword, or scroll down for more. <b>crosswords uploaded daily at 10 PM EST.</b> there's a join function so you can play with friends too if you click the person icon with the plus symbol.</p>
  <br>

  <!-- ðŸ”¥ This is where the latest puzzle will be injected -->
  <div id="latest-puzzle"></div>

  <br>
  <h2>archive</h2>
  <p>click the <u><b>puzzle</b></u> to play. click <b>jonathan's notes</b> for commentaryâ€”please note there may be <b>spoilers</b>. open at your own discretion</p>

  <ol id="archive">
    <!-- Archive will be populated here -->
  </ol>

<script>
  fetch('puzzles.json')
    .then(response => response.json())
    .then(data => {
      const archiveList = document.getElementById('archive');
      const latestPuzzleContainer = document.getElementById('latest-puzzle');

      // Sort newest first
      data.sort((a, b) => new Date(b.date) - new Date(a.date));

      const today = data[0]; // most recent puzzle

      // Log the raw date and the parsed date
      console.log("Raw Date:", today.date);
      const mainPuzzleDate = new Date(today.date + "T00:00:00Z"); // Convert to UTC
      console.log("Parsed Date:", mainPuzzleDate);
      
      // Use UTC for date formatting
      const formattedDate = mainPuzzleDate.toLocaleDateString("en-US", {
        year: 'numeric',
        month: 'short',
        day: 'numeric'
      });

      console.log("Formatted Date:", formattedDate);  // Log formatted date

      latestPuzzleContainer.innerHTML = `
        <h2>${today.title} ${formattedDate}</h2>
        <iframe
          src="${today.iframe}"
          style="border:none; width: 100%; height: 600px;"
          allow="web-share; fullscreen"
          aria-label="Puzzle Me Game">
        </iframe>
      `;

      // ðŸ“š Build archive (skip today's puzzle)
      const archive = data.slice(1, 11);
      archive.forEach(puzzle => {
        const li = document.createElement('li');
        const date = new Date(puzzle.date + "T00:00:00Z"); // Convert to UTC
        const formattedDate = date.toLocaleDateString("en-US", {
          year: 'numeric',
          month: 'short',
          day: 'numeric'
        });
        li.innerHTML = `
          <a href="${puzzle.filename}">${puzzle.title}</a> ${formattedDate}
          <details>
            <summary>jonathan's notes</summary>
            <p>${puzzle.notes}</p>
          </details>
        `;
        archiveList.appendChild(li);
      });
    })
    .catch(error => {
      document.getElementById('archive').innerHTML = '<li>Error loading archive.</li>';
      console.error('Error fetching puzzle list:', error);
    });
</script>




</body>
</html>
